# Uncomment this zmodload and the `zprof` at the bottom of the file
# to profile the startup time
# zmodload zsh/zprof  
set +x

if [[ -f "/opt/homebrew/share/antigen/antigen.zsh" ]]; then
  export ANTIGEN_HOME="/opt/homebrew/share/antigen/"
elif [[ -f "$HOME/.antigen/antigen.zsh" ]]; then
  export ANTIGEN_HOME="$HOME/.antigen/antigen.zsh"
fi

if [[ "$ANTIGEN_HOME" != "" ]]; then
  source $ANTIGEN_HOME/antigen.zsh
  antigen bundle "mafredri/zsh-async" --branch=main async.zsh

  antigen use oh-my-zsh
  mkdir $ZSH_CACHE_DIR/completions 2>/dev/null
  antigen bundle "mise"
  antigen bundle "bgnotify"
  antigen bundle "colored-man-pages"
  antigen bundle "command-not-found"
  antigen bundle "python"
  antigen bundle "gitfast"
  antigen bundle "docker"
  antigen bundle "tmux"
  antigen bundle "aws"
  antigen bundle "vi-mode"
  antigen bundle "kubectl"
  if [[ "$USER" == "mwalsh2" ]]; then
    # Only enable atlassian custom stuff if logged in via atlassian computer
    antigen bundle "$HOME/dotfiles/config/zsh/acse-kratos"
  fi
  antigen bundle "$HOME/dotfiles/config/zsh/miek-aliases-etc"
  if [[ $EUID != 0 ]]; then
    ## Skip zoxide for root user to avoid corrupting DB
    antigen bundle "zoxide"
  fi
  antigen theme "romkatv/powerlevel10k"
  antigen bundle "davidde/git"
  antigen bundle "djui/alias-tips"
  antigen bundle "zsh-users/zsh-autosuggestions"
  antigen bundle "zdharma-continuum/fast-syntax-highlighting"
fi

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
    source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

if [[ $EUID == 0 ]]; then
    # root user needs to set this as disabled or we get warnings
    # (assuming that root is configured to use the same directory as home)
    export ZSH_DISABLE_COMPFIX="true"
fi

HISTCONTROL="ignorespace"

# .zshenv is where I setup custom paths
[[ ! -f ~!/.zshenv ]] || source ~/.zshenv

# Uncomment the following line to have your zsh autostart/join a tmux session
# export ZSH_TMUX_AUTOSTART=true

if [[ "$ANTIGEN_HOME" != "" ]]; then
  antigen apply
fi

[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
# uncomment if debugging differences
# source ~/.oh-my-zsh/oh-my-zsh.sh

# uncomment this (and the first line of the file) to profile the startup
# zprof
